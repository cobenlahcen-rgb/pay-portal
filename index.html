<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>NextGen AI Hub ‚Äî Conversation Experience</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- ‚úÖ Whop Embedded Checkout Loader (required) -->
<script async defer src="https://js.whop.com/static/checkout/loader.js"></script>

<style>
:root{
  --bg:#0a0a12;
  --card:rgba(19,19,36,.92);
  --accent:#7c5cff;
  --accent2:#4ade80;
  --text:#f4f4ff;
  --muted:#a1a1c8;
  --stroke:rgba(124,92,255,.25);
}
*{box-sizing:border-box;font-family:Inter,system-ui,Arial}
body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(900px 450px at 18% -8%,rgba(124,92,255,.25),transparent 60%),
    radial-gradient(700px 380px at 85% 0%,rgba(74,222,128,.16),transparent 55%),
    var(--bg);
  color:var(--text);
}
.container{max-width:980px;margin:auto;padding:28px}
.card{
  background:var(--card);
  border:1px solid rgba(255,255,255,.06);
  border-radius:22px;
  padding:28px;
  box-shadow:0 30px 90px rgba(0,0,0,.62);
  backdrop-filter: blur(10px);
}
h1{font-size:40px;margin:0 0 10px;letter-spacing:-.4px}
h2{margin:0 0 10px;font-size:24px}
p{color:var(--muted);margin:10px 0 0;line-height:1.45}
.small{font-size:12px;color:var(--muted)}
.hidden{display:none}

.toprow{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.pill{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 12px;border-radius:999px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  color:var(--muted);font-size:12px;
}

.btn{
  display:inline-flex;align-items:center;justify-content:center;
  gap:10px;
  background:linear-gradient(135deg,var(--accent),rgba(124,92,255,.65));
  border:none;
  color:#fff;
  padding:14px 22px;
  border-radius:14px;
  font-weight:800;
  cursor:pointer;
  text-decoration:none;
  box-shadow:0 18px 40px rgba(124,92,255,.18);
  transition:.15s transform,.15s filter;
}
.btn:hover{transform:translateY(-1px);filter:saturate(1.1)}
.btn:active{transform:translateY(0px)}
.btn.secondary{
  background:transparent;
  border:1px solid rgba(124,92,255,.45);
  box-shadow:none;
  color:var(--text);
}
.btn.link{
  background:transparent;border:none;box-shadow:none;
  color:var(--muted);padding:10px 0;font-weight:700;
  text-decoration:underline;cursor:pointer
}
.actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px;align-items:center}

.progress{
  height:8px;background:#222;border-radius:10px;overflow:hidden;margin:16px 0 14px;
  border:1px solid rgba(255,255,255,.06)
}
.bar{
  height:100%;width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:.25s ease;
}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px}
.avatar{
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
  border:2px solid transparent;
  transition:.18s;
  background:#0f0f1a;
  position:relative;
}
.avatar img{
  width:100%;
  aspect-ratio: 4/5;
  object-fit:cover;
  display:block;
  border-radius:14px;
}
.avatar .label{
  padding:10px 12px 14px;
  font-size:12px;
  color:var(--muted);
}
.avatar:hover{transform:translateY(-3px)}
.avatar.active{border-color:var(--accent);box-shadow:0 0 0 4px rgba(124,92,255,.14)}

.choice{
  padding:14px;
  background:#17172b;
  border:1px solid rgba(255,255,255,.06);
  border-radius:14px;
  margin-top:10px;
  cursor:pointer;
  transition:.15s;
}
.choice:hover{background:#1e1e38}

.chatwrap{
  display:flex;gap:16px;align-items:center;flex-wrap:wrap;
  margin-top:14px;
  padding:14px;
  border-radius:18px;
  background:rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.07);
}
.chatwrap img{
  width:88px;height:88px;border-radius:18px;object-fit:cover;
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 18px 40px rgba(0,0,0,.35);
}
.bubble{
  flex:1;
  min-width:220px;
  padding:12px 14px;
  border-radius:16px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  color:var(--text);
  line-height:1.45;
}
.bubble .muted{color:var(--muted);font-size:12px;margin-top:6px}

.priceRow{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:14px;
  margin-top:14px;
}
.plan{
  padding:16px;border-radius:18px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.07);
}
.plan .tag{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  font-size:12px;
  background:rgba(124,92,255,.14);
  border:1px solid rgba(124,92,255,.22);
  color:var(--text);
}
.plan .big{font-size:30px;font-weight:900;margin:10px 0 2px}
.plan ul{margin:10px 0 0;padding-left:18px;color:var(--muted)}
.plan li{margin:6px 0}

.footerNote{
  margin-top:14px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.06);
}

/* =========================
   ‚úÖ Whop Modal (Professional + Responsive + Scroll)
   ========================= */
.ng-modal{
  position:fixed;
  inset:0;
  display:none;
  z-index:9999;
}
.ng-modal.is-open{display:block}

.ng-modal__backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.72);
  backdrop-filter: blur(6px);
}

.ng-modal__panel{
  position:relative;
  width:min(1020px, calc(100% - 20px));
  height:min(92vh, 820px);
  margin:10px auto;
  background:#0b0b0f;
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;
  box-shadow:0 30px 90px rgba(0,0,0,.65);
  overflow:hidden;

  display:flex;
  flex-direction:column;
}

.ng-modal__header{
  padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.ng-modal__title{
  font-weight:900;
  font-size:15px;
  letter-spacing:-.2px;
}

.ng-modal__subtitle{
  opacity:.75;
  font-size:12px;
  white-space:nowrap;
}

.ng-modal__close{
  position:absolute;
  top:10px;
  right:10px;
  width:40px;
  height:40px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:#fff;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}
.ng-modal__close:hover{ background:rgba(255,255,255,.10); }

#whop-embedded-checkout{
  flex:1;
  min-height:0;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  background:#fff;
}
#whop-embedded-checkout::-webkit-scrollbar{ width:10px; }
#whop-embedded-checkout::-webkit-scrollbar-thumb{
  background: rgba(0,0,0,.18);
  border-radius: 999px;
}

.ng-modal__error{
  position:absolute;
  left:16px;
  right:16px;
  bottom:14px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,0,0,.12);
  border:1px solid rgba(255,0,0,.25);
  font-size:13px;
  color:rgba(255,255,255,.92);
}

@media (max-width: 640px){
  .ng-modal__panel{
    width: calc(100% - 12px);
    height: 94vh;
    margin: 6px auto;
    border-radius: 16px;
  }
  .ng-modal__subtitle{ display:none; }
}
</style>
</head>

<body>
<div class="container">

<!-- HERO -->
<div id="hero" class="card">
  <div class="toprow">
    <div class="pill">chat.nextgenaihub.net ‚Ä¢ Personalized AI conversation</div>
    <div class="pill">Safe content ‚Ä¢ No therapy ‚Ä¢ No adult interactions</div>
  </div>

  <h1 style="margin-top:16px;">Create Your Conversation Experience</h1>
  <p>Choose a style. Answer 3 quick questions. Get a personalized conversation setup in seconds.</p>

  <div class="actions">
    <button class="btn" onclick="go('avatars')">Start Free Experience</button>
    <button class="btn secondary" onclick="scrollToHow()">How it works</button>
  </div>

  <div id="how" class="footerNote">
    <p class="small">
      ‚ö° Fast setup ‚Ä¢ üîí Secure checkout handled by Whop ‚Ä¢ ‚úÖ Works on all devices
    </p>
  </div>
</div>

<!-- AVATAR SELECT -->
<div id="avatars" class="card hidden">
  <div class="progress"><div class="bar" style="width:20%"></div></div>
  <h2>Choose a conversation style</h2>
  <p class="small">Pick the vibe that fits you. You can change it anytime.</p>

  <div class="grid" style="margin-top:14px;">
    <div class="avatar" onclick="selectAvatar(1)">
      <img src="assets/companion1.png" alt="Friendly & Conversational">
      <div class="label">Friendly & Conversational</div>
    </div>

    <div class="avatar" onclick="selectAvatar(2)">
      <img src="assets/companion2.png" alt="Calm & Insightful">
      <div class="label">Calm & Insightful</div>
    </div>

    <div class="avatar" onclick="selectAvatar(3)">
      <img src="assets/companion3.png" alt="Focused & Thoughtful">
      <div class="label">Focused & Thoughtful</div>
    </div>

    <div class="avatar" onclick="selectAvatar(4)">
      <img src="assets/companion4.png" alt="Experienced & Professional">
      <div class="label">Experienced & Professional</div>
    </div>
  </div>

  <div class="actions">
    <button class="btn secondary" onclick="go('hero')">Back</button>
  </div>
</div>

<!-- QUIZ -->
<div id="quiz" class="card hidden">
  <div class="progress"><div id="bar" class="bar"></div></div>

  <h2 id="q"></h2>
  <div id="opts"></div>

  <div class="actions">
    <button class="btn secondary" onclick="go('avatars')">Back</button>
  </div>
</div>

<!-- LOADING -->
<div id="loading" class="card hidden">
  <h2>Customizing your experience‚Ä¶</h2>
  <p>Matching your style + preferences</p>
  <div class="progress" style="margin-top:16px;"><div id="loadbar" class="bar" style="width:0%"></div></div>
  <p class="small" id="loadtxt" style="margin-top:10px;">Preparing your first message‚Ä¶</p>
</div>

<!-- RESULT -->
<div id="result" class="card hidden">
  <h2>Your experience is ready</h2>

  <div class="chatwrap">
    <img id="avatarPreview" src="assets/companion1.png" alt="Selected companion">
    <div class="bubble">
      <div id="resMsg">‚ÄúI‚Äôm here to explore ideas with you ‚Äî whether it‚Äôs deep thinking, creative stories, or everyday conversation.‚Äù</div>
      <div class="muted">Your selected style is ready. Continue to unlock full access.</div>
    </div>
  </div>

  <div class="actions">
    <button class="btn secondary" onclick="go('avatars')">Change style</button>
    <button class="btn" onclick="go('price')">Continue</button>
  </div>

  <p class="small" style="margin-top:10px;">Tip: Most users start the free trial right after setup to keep personalization.</p>
</div>

<!-- PRICE (‚úÖ Updated for free trial) -->
<div id="price" class="card hidden">
  <div class="toprow">
    <div class="pill">7-day free trial included</div>
    <div class="pill">Cancel anytime</div>
  </div>

  <h2 style="margin-top:14px;">Start Your Free Trial</h2>
  <p class="small">No charge today. Your selected conversation style is saved.</p>

  <div class="priceRow">
    <div class="plan">
      <div class="tag">Free Trial</div>
      <div class="big">$0 today</div>
      <div class="small">Then $19 / month after 7 days</div>
      <ul>
        <li>7-day free trial</li>
        <li>Unlimited safe conversations</li>
        <li>Cancel anytime during trial</li>
        <li>No commitment</li>
      </ul>
    </div>
  </div>

  <div class="actions" style="margin-top:18px;">
    <button class="btn" onclick="openWhopModal()">Start 7-Day Free Trial</button>
    <button class="btn secondary" onclick="go('result')">Back</button>
  </div>

  <p class="small" style="margin-top:10px;">
    $0 today ¬∑ No card charged until trial ends ¬∑ Secure checkout by Whop
  </p>
</div>

<!-- SUCCESS -->
<div id="success" class="card hidden">
  <div class="toprow">
    <div class="pill">Trial started</div>
    <div class="pill">Cancel anytime</div>
  </div>

  <h2 style="margin-top:14px;">‚úÖ Free trial active</h2>
  <p class="small">You‚Äôre in. Your trial is active and your setup is saved.</p>

  <div class="footerNote">
    <p class="small" style="margin:0;">
      Receipt: <span id="receiptIdText">Confirmed</span>
    </p>
  </div>

  <div class="actions" style="margin-top:18px;">
    <button class="btn" onclick="go('hero')">Back to start</button>
    <button class="btn secondary" onclick="go('result')">View setup</button>
  </div>

  <p class="small" style="margin-top:10px;">
    Next: we‚Äôll add webhook-based unlock automation. For now, this confirms your trial and routes you forward.
  </p>
</div>

</div>

<!-- ‚úÖ Whop Checkout Modal -->
<div id="whopModal" class="ng-modal" aria-hidden="true">
  <div class="ng-modal__backdrop" onclick="closeWhopModal()"></div>

  <div class="ng-modal__panel" role="dialog" aria-modal="true" aria-label="Checkout">
    <button class="ng-modal__close" onclick="closeWhopModal()" aria-label="Close checkout">‚úï</button>

    <div class="ng-modal__header">
      <div>
        <div class="ng-modal__title">Start Free Trial</div>
        <div class="ng-modal__subtitle">7 days free ¬∑ Cancel anytime</div>
      </div>
    </div>

    <div
      id="whop-embedded-checkout"
      data-whop-checkout-plan-id="plan_bjy3o9ZScfqmY"
      data-whop-checkout-return-url="https://nextgenaihub.net/?whop_return=1"
      data-whop-checkout-on-complete="onCheckoutComplete"
      data-whop-checkout-on-state-change="onCheckoutStateChange"
    ></div>

    <div id="whopError" class="ng-modal__error" style="display:none;">
      Checkout didn‚Äôt complete. Please try again.
    </div>
  </div>
</div>

<script>
/**
 * CONFIG
 */
const WHOP_PLAN_ID = "plan_bjy3o9ZScfqmY";
const RETURN_URL = "https://nextgenaihub.net/?whop_return=1";

/**
 * Avatar images
 */
const AVATAR_BASE = {
  1: "assets/companion1.png",
  2: "assets/companion2.png",
  3: "assets/companion3.png",
  4: "assets/companion4.png",
};

function getMessagePoseSrc(n){
  return AVATAR_BASE[n];
  // If you upload these later:
  // return `assets/companion${n}_msg.png`;
}

let avatar = 1;
let step = 0;
let firstAvatarVisit = true;

const answers = [];

// Safe questions
const qs = [
  ["What kind of conversations do you enjoy most?", ["Creative storytelling", "Deep conversations", "Daily conversations", "Ideas & brainstorming"]],
  ["Choose a tone", ["Calm", "Playful", "Bold", "Thoughtful"]],
  ["Reply style?", ["Short", "Balanced", "Detailed"]],
];

function scrollToHow(){
  document.getElementById('how').scrollIntoView({behavior:'smooth',block:'start'});
}

function go(id){
  document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');

  if(id === 'avatars' && firstAvatarVisit){
    firstAvatarVisit = false;
    selectAvatar(1, true);
  }

  if(id === 'avatars'){
    step = 0;
    answers.length = 0;
    const b = document.getElementById('bar');
    if(b) b.style.width = '0%';
  }
}

/* ‚úÖ Whop modal controls */
function openWhopModal(){
  const modal = document.getElementById("whopModal");
  const checkout = document.getElementById("whop-embedded-checkout");
  const err = document.getElementById("whopError");
  if (err) err.style.display = "none";

  checkout.setAttribute("data-whop-checkout-plan-id", WHOP_PLAN_ID);
  checkout.setAttribute("data-whop-checkout-return-url", RETURN_URL);

  modal.classList.add("is-open");
  modal.setAttribute("aria-hidden", "false");

  document.body.style.overflow = "hidden";
  document.documentElement.style.overflow = "hidden";
}

function closeWhopModal(){
  const modal = document.getElementById("whopModal");
  modal.classList.remove("is-open");
  modal.setAttribute("aria-hidden", "true");

  document.body.style.overflow = "";
  document.documentElement.style.overflow = "";
}

/* Whop callbacks */
window.onCheckoutComplete = (planId, receiptId) => {
  closeWhopModal();

  localStorage.setItem("ng_paid", "true");
  localStorage.setItem("ng_whop_plan_id", planId || "");
  localStorage.setItem("ng_whop_receipt_id", receiptId || "");

  const receiptEl = document.getElementById("receiptIdText");
  if (receiptEl) receiptEl.textContent = receiptId ? receiptId : "Confirmed";

  go("success");
};

window.onCheckoutStateChange = (state) => {
  // console.log("Whop checkout state:", state);
};

/* Return URL handler */
(function handleWhopReturn(){
  const url = new URL(window.location.href);
  const whopReturn = url.searchParams.get("whop_return");
  const status = url.searchParams.get("status");

  if (!whopReturn) return;

  url.searchParams.delete("whop_return");
  url.searchParams.delete("status");
  window.history.replaceState({}, "", url.toString());

  if (status === "success") {
    localStorage.setItem("ng_paid", "true");
    const receiptEl = document.getElementById("receiptIdText");
    if (receiptEl) receiptEl.textContent = localStorage.getItem("ng_whop_receipt_id") || "Confirmed";
    go("success");
  } else {
    go("price");
    const err = document.getElementById("whopError");
    if (err) err.style.display = "block";
    openWhopModal();
  }
})();

/* Funnel logic */
function selectAvatar(n, skipAutoGo){
  avatar = n;

  document.querySelectorAll('.avatar').forEach(a => a.classList.remove('active'));
  document.querySelectorAll('.avatar')[n-1].classList.add('active');

  const preview = document.getElementById("avatarPreview");
  if(preview){ preview.src = getMessagePoseSrc(n); }

  if(skipAutoGo) return;

  setTimeout(() => { go('quiz'); render(); }, 180);
}

function render(){
  const b = document.getElementById('bar');
  if(b) b.style.width = ((step+1)/qs.length*100) + '%';

  document.getElementById('q').innerText = qs[step][0];

  let o = document.getElementById('opts');
  o.innerHTML = '';

  qs[step][1].forEach(v => {
    let d = document.createElement('div');
    d.className = 'choice';
    d.innerText = v;
    d.onclick = () => next(v);
    o.appendChild(d);
  });
}

function next(choice){
  answers.push(choice);
  step++;

  if(step < qs.length){
    render();
    return;
  }

  go('loading');
  const loadbar = document.getElementById('loadbar');
  const loadtxt = document.getElementById('loadtxt');

  let pct = 0;
  const msgs = [
    "Preparing your first message‚Ä¶",
    "Adjusting tone and pacing‚Ä¶",
    "Finalizing conversation style‚Ä¶",
    "Ready."
  ];

  const timer = setInterval(() => {
    pct += Math.floor(Math.random()*16) + 10;
    if(pct > 100) pct = 100;
    if(loadbar) loadbar.style.width = pct + "%";
    if(loadtxt){
      const idx = Math.min(msgs.length-1, Math.floor(pct/34));
      loadtxt.innerText = msgs[idx];
    }
    if(pct >= 100){
      clearInterval(timer);
      setTimeout(() => showResult(), 280);
    }
  }, 180);
}

function showResult(){
  go('result');

  const [topic, tone, style] = answers;
  const toneLine = {
    Calm: "calm and clear",
    Playful: "light and creative",
    Bold: "direct and confident",
    Thoughtful: "deep and reflective"
  }[tone] || "balanced";

  const styleLine = {
    Short: "short replies",
    Balanced: "balanced replies",
    Detailed: "detailed replies"
  }[style] || "balanced replies";

  document.getElementById('resMsg').innerText =
    `‚ÄúPerfect ‚Äî I‚Äôll keep it ${toneLine} with ${styleLine}. Let‚Äôs start with ${String(topic || "").toLowerCase()}.‚Äù`;

  const preview = document.getElementById("avatarPreview");
  if(preview) preview.src = getMessagePoseSrc(avatar);
}

go('hero');
</script>

</body>
</html>
